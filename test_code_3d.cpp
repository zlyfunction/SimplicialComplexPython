TEST_CASE("top_coface_simplex_bunny_tetwild_80", "[simplicial_complex][top_coface_simplex][3D]")
{
    Eigen::MatrixXd V;
    Eigen::MatrixXi T;
    Eigen::MatrixXi F;
    Eigen::VectorXi Tritag, Tettag;
    std::string name = "/bunny_tetwild_80.msh";
    std::string path;
    path.append(WMTK_DATA_DIR);
    path.append(name);
    igl::readMSH(path, V, F, T, Tritag, Tettag);
    tests_3d::DEBUG_TetMesh m;
    RowVectors4l Tr;
    Tr.resize(T.rows(), T.cols());
    assert(T.cols() == 4);
    for (long i = 0; i < T.rows(); i++) {
        Tr(i, 0) = T(i, 0);
        Tr(i, 1) = T(i, 1);
        Tr(i, 2) = T(i, 2);
        Tr(i, 3) = T(i, 3);
    }
    m.initialize(Tr);
    
    Tuple t;
    std::vector<std::vector<long>> sc_v, sc_e, sc_f, sc_t;
    t = m.tuple_from_id(PV, 2143);
    REQUIRE(m.is_valid_slow(t));    sc_v = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PV, t)).get_simplex_vector());
    REQUIRE(sc_v.size() == 6);
    CHECK(sc_v[0][0] == 2041);
    CHECK(sc_v[0][1] == 2060);
    CHECK(sc_v[0][2] == 2143);
    CHECK(sc_v[0][3] == 2297);
    CHECK(sc_v[1][0] == 2041);
    CHECK(sc_v[1][1] == 2128);
    CHECK(sc_v[1][2] == 2143);
    CHECK(sc_v[1][3] == 2222);
    CHECK(sc_v[2][0] == 2041);
    CHECK(sc_v[2][1] == 2143);
    CHECK(sc_v[2][2] == 2222);
    CHECK(sc_v[2][3] == 2297);
    CHECK(sc_v[3][0] == 2060);
    CHECK(sc_v[3][1] == 2137);
    CHECK(sc_v[3][2] == 2143);
    CHECK(sc_v[3][3] == 2297);
    CHECK(sc_v[4][0] == 2137);
    CHECK(sc_v[4][1] == 2143);
    CHECK(sc_v[4][2] == 2232);
    CHECK(sc_v[4][3] == 2297);
    CHECK(sc_v[5][0] == 2143);
    CHECK(sc_v[5][1] == 2222);
    CHECK(sc_v[5][2] == 2232);
    CHECK(sc_v[5][3] == 2297);

    t = m.tuple_from_id(PV, 6450);
    REQUIRE(m.is_valid_slow(t));    sc_v = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PV, t)).get_simplex_vector());
    REQUIRE(sc_v.size() == 6);
    CHECK(sc_v[0][0] == 6366);
    CHECK(sc_v[0][1] == 6408);
    CHECK(sc_v[0][2] == 6425);
    CHECK(sc_v[0][3] == 6450);
    CHECK(sc_v[1][0] == 6408);
    CHECK(sc_v[1][1] == 6425);
    CHECK(sc_v[1][2] == 6450);
    CHECK(sc_v[1][3] == 7408);
    CHECK(sc_v[2][0] == 6408);
    CHECK(sc_v[2][1] == 6450);
    CHECK(sc_v[2][2] == 6483);
    CHECK(sc_v[2][3] == 7408);
    CHECK(sc_v[3][0] == 6425);
    CHECK(sc_v[3][1] == 6450);
    CHECK(sc_v[3][2] == 6476);
    CHECK(sc_v[3][3] == 7408);
    CHECK(sc_v[4][0] == 6450);
    CHECK(sc_v[4][1] == 6476);
    CHECK(sc_v[4][2] == 6546);
    CHECK(sc_v[4][3] == 7408);
    CHECK(sc_v[5][0] == 6450);
    CHECK(sc_v[5][1] == 6483);
    CHECK(sc_v[5][2] == 6546);
    CHECK(sc_v[5][3] == 7408);

    t = m.tuple_from_id(PV, 1611);
    REQUIRE(m.is_valid_slow(t));    sc_v = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PV, t)).get_simplex_vector());
    REQUIRE(sc_v.size() == 5);
    CHECK(sc_v[0][0] == 1535);
    CHECK(sc_v[0][1] == 1611);
    CHECK(sc_v[0][2] == 1615);
    CHECK(sc_v[0][3] == 1945);
    CHECK(sc_v[1][0] == 1535);
    CHECK(sc_v[1][1] == 1611);
    CHECK(sc_v[1][2] == 1619);
    CHECK(sc_v[1][3] == 1945);
    CHECK(sc_v[2][0] == 1611);
    CHECK(sc_v[2][1] == 1615);
    CHECK(sc_v[2][2] == 1722);
    CHECK(sc_v[2][3] == 1945);
    CHECK(sc_v[3][0] == 1611);
    CHECK(sc_v[3][1] == 1619);
    CHECK(sc_v[3][2] == 1793);
    CHECK(sc_v[3][3] == 1945);
    CHECK(sc_v[4][0] == 1611);
    CHECK(sc_v[4][1] == 1722);
    CHECK(sc_v[4][2] == 1793);
    CHECK(sc_v[4][3] == 1945);

    t = m.tuple_from_id(PV, 4298);
    REQUIRE(m.is_valid_slow(t));    sc_v = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PV, t)).get_simplex_vector());
    REQUIRE(sc_v.size() == 6);
    CHECK(sc_v[0][0] == 4074);
    CHECK(sc_v[0][1] == 4153);
    CHECK(sc_v[0][2] == 4298);
    CHECK(sc_v[0][3] == 7811);
    CHECK(sc_v[1][0] == 4074);
    CHECK(sc_v[1][1] == 4298);
    CHECK(sc_v[1][2] == 4398);
    CHECK(sc_v[1][3] == 7811);
    CHECK(sc_v[2][0] == 4153);
    CHECK(sc_v[2][1] == 4272);
    CHECK(sc_v[2][2] == 4298);
    CHECK(sc_v[2][3] == 7811);
    CHECK(sc_v[3][0] == 4272);
    CHECK(sc_v[3][1] == 4298);
    CHECK(sc_v[3][2] == 4367);
    CHECK(sc_v[3][3] == 7811);
    CHECK(sc_v[4][0] == 4298);
    CHECK(sc_v[4][1] == 4367);
    CHECK(sc_v[4][2] == 4399);
    CHECK(sc_v[4][3] == 7811);
    CHECK(sc_v[5][0] == 4298);
    CHECK(sc_v[5][1] == 4398);
    CHECK(sc_v[5][2] == 4399);
    CHECK(sc_v[5][3] == 7811);

    t = m.tuple_from_id(PV, 4158);
    REQUIRE(m.is_valid_slow(t));    sc_v = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PV, t)).get_simplex_vector());
    REQUIRE(sc_v.size() == 10);
    CHECK(sc_v[0][0] == 4012);
    CHECK(sc_v[0][1] == 4039);
    CHECK(sc_v[0][2] == 4065);
    CHECK(sc_v[0][3] == 4158);
    CHECK(sc_v[1][0] == 4012);
    CHECK(sc_v[1][1] == 4039);
    CHECK(sc_v[1][2] == 4085);
    CHECK(sc_v[1][3] == 4158);
    CHECK(sc_v[2][0] == 4012);
    CHECK(sc_v[2][1] == 4065);
    CHECK(sc_v[2][2] == 4158);
    CHECK(sc_v[2][3] == 4204);
    CHECK(sc_v[3][0] == 4012);
    CHECK(sc_v[3][1] == 4085);
    CHECK(sc_v[3][2] == 4113);
    CHECK(sc_v[3][3] == 4158);
    CHECK(sc_v[4][0] == 4012);
    CHECK(sc_v[4][1] == 4113);
    CHECK(sc_v[4][2] == 4158);
    CHECK(sc_v[4][3] == 4204);
    CHECK(sc_v[5][0] == 4085);
    CHECK(sc_v[5][1] == 4113);
    CHECK(sc_v[5][2] == 4158);
    CHECK(sc_v[5][3] == 4160);
    CHECK(sc_v[6][0] == 4113);
    CHECK(sc_v[6][1] == 4158);
    CHECK(sc_v[6][2] == 4160);
    CHECK(sc_v[6][3] == 4328);
    CHECK(sc_v[7][0] == 4113);
    CHECK(sc_v[7][1] == 4158);
    CHECK(sc_v[7][2] == 4204);
    CHECK(sc_v[7][3] == 4328);
    CHECK(sc_v[8][0] == 4158);
    CHECK(sc_v[8][1] == 4160);
    CHECK(sc_v[8][2] == 4321);
    CHECK(sc_v[8][3] == 4328);
    CHECK(sc_v[9][0] == 4158);
    CHECK(sc_v[9][1] == 4204);
    CHECK(sc_v[9][2] == 4321);
    CHECK(sc_v[9][3] == 4328);

    t = m.edge_tuple_from_vids(2230,2288);
    REQUIRE(m.is_valid_slow(t));    sc_e = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PE, t)).get_simplex_vector());
    REQUIRE(sc_e.size() == 2);
    CHECK(sc_e[0][0] == 2153);
    CHECK(sc_e[0][1] == 2230);
    CHECK(sc_e[0][2] == 2288);
    CHECK(sc_e[0][3] == 2517);
    CHECK(sc_e[1][0] == 2230);
    CHECK(sc_e[1][1] == 2288);
    CHECK(sc_e[1][2] == 2399);
    CHECK(sc_e[1][3] == 2517);

    t = m.edge_tuple_from_vids(6216,6444);
    REQUIRE(m.is_valid_slow(t));    sc_e = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PE, t)).get_simplex_vector());
    REQUIRE(sc_e.size() == 3);
    CHECK(sc_e[0][0] == 6216);
    CHECK(sc_e[0][1] == 6344);
    CHECK(sc_e[0][2] == 6444);
    CHECK(sc_e[0][3] == 7455);
    CHECK(sc_e[1][0] == 6216);
    CHECK(sc_e[1][1] == 6431);
    CHECK(sc_e[1][2] == 6444);
    CHECK(sc_e[1][3] == 7893);
    CHECK(sc_e[2][0] == 6216);
    CHECK(sc_e[2][1] == 6444);
    CHECK(sc_e[2][2] == 7455);
    CHECK(sc_e[2][3] == 7893);

    t = m.edge_tuple_from_vids(7141,7150);
    REQUIRE(m.is_valid_slow(t));    sc_e = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PE, t)).get_simplex_vector());
    REQUIRE(sc_e.size() == 1);
    CHECK(sc_e[0][0] == 7126);
    CHECK(sc_e[0][1] == 7141);
    CHECK(sc_e[0][2] == 7150);
    CHECK(sc_e[0][3] == 7164);

    t = m.edge_tuple_from_vids(5394,5475);
    REQUIRE(m.is_valid_slow(t));    sc_e = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PE, t)).get_simplex_vector());
    REQUIRE(sc_e.size() == 5);
    CHECK(sc_e[0][0] == 5294);
    CHECK(sc_e[0][1] == 5327);
    CHECK(sc_e[0][2] == 5394);
    CHECK(sc_e[0][3] == 5475);
    CHECK(sc_e[1][0] == 5294);
    CHECK(sc_e[1][1] == 5352);
    CHECK(sc_e[1][2] == 5394);
    CHECK(sc_e[1][3] == 5475);
    CHECK(sc_e[2][0] == 5352);
    CHECK(sc_e[2][1] == 5394);
    CHECK(sc_e[2][2] == 5422);
    CHECK(sc_e[2][3] == 5475);
    CHECK(sc_e[3][0] == 5394);
    CHECK(sc_e[3][1] == 5422);
    CHECK(sc_e[3][2] == 5475);
    CHECK(sc_e[3][3] == 5492);
    CHECK(sc_e[4][0] == 5394);
    CHECK(sc_e[4][1] == 5475);
    CHECK(sc_e[4][2] == 5492);
    CHECK(sc_e[4][3] == 5537);

    t = m.edge_tuple_from_vids(2063,3083);
    REQUIRE(m.is_valid_slow(t));    sc_e = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PE, t)).get_simplex_vector());
    REQUIRE(sc_e.size() == 5);
    CHECK(sc_e[0][0] == 2063);
    CHECK(sc_e[0][1] == 3083);
    CHECK(sc_e[0][2] == 3151);
    CHECK(sc_e[0][3] == 7404);
    CHECK(sc_e[1][0] == 2063);
    CHECK(sc_e[1][1] == 3083);
    CHECK(sc_e[1][2] == 3151);
    CHECK(sc_e[1][3] == 7837);
    CHECK(sc_e[2][0] == 2063);
    CHECK(sc_e[2][1] == 3083);
    CHECK(sc_e[2][2] == 3687);
    CHECK(sc_e[2][3] == 7437);
    CHECK(sc_e[3][0] == 2063);
    CHECK(sc_e[3][1] == 3083);
    CHECK(sc_e[3][2] == 3687);
    CHECK(sc_e[3][3] == 7837);
    CHECK(sc_e[4][0] == 2063);
    CHECK(sc_e[4][1] == 3083);
    CHECK(sc_e[4][2] == 7404);
    CHECK(sc_e[4][3] == 7437);

    t = m.face_tuple_from_vids(5672, 5709, 7814);
    REQUIRE(m.is_valid_slow(t));    sc_f = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PF, t)).get_simplex_vector());
    REQUIRE(sc_f.size() == 2);
    CHECK(sc_f[0][0] == 5612);
    CHECK(sc_f[0][1] == 5672);
    CHECK(sc_f[0][2] == 5709);
    CHECK(sc_f[0][3] == 7814);
    CHECK(sc_f[1][0] == 5672);
    CHECK(sc_f[1][1] == 5709);
    CHECK(sc_f[1][2] == 5753);
    CHECK(sc_f[1][3] == 7814);

    t = m.face_tuple_from_vids(512, 2757, 4143);
    REQUIRE(m.is_valid_slow(t));    sc_f = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PF, t)).get_simplex_vector());
    REQUIRE(sc_f.size() == 2);
    CHECK(sc_f[0][0] == 512);
    CHECK(sc_f[0][1] == 2757);
    CHECK(sc_f[0][2] == 4143);
    CHECK(sc_f[0][3] == 4597);
    CHECK(sc_f[1][0] == 512);
    CHECK(sc_f[1][1] == 2757);
    CHECK(sc_f[1][2] == 4143);
    CHECK(sc_f[1][3] == 7677);

    t = m.face_tuple_from_vids(7055, 7144, 7156);
    REQUIRE(m.is_valid_slow(t));    sc_f = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PF, t)).get_simplex_vector());
    REQUIRE(sc_f.size() == 1);
    CHECK(sc_f[0][0] == 7055);
    CHECK(sc_f[0][1] == 7144);
    CHECK(sc_f[0][2] == 7156);
    CHECK(sc_f[0][3] == 7799);

    t = m.face_tuple_from_vids(392, 476, 7753);
    REQUIRE(m.is_valid_slow(t));    sc_f = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PF, t)).get_simplex_vector());
    REQUIRE(sc_f.size() == 2);
    CHECK(sc_f[0][0] == 392);
    CHECK(sc_f[0][1] == 399);
    CHECK(sc_f[0][2] == 476);
    CHECK(sc_f[0][3] == 7753);
    CHECK(sc_f[1][0] == 392);
    CHECK(sc_f[1][1] == 422);
    CHECK(sc_f[1][2] == 476);
    CHECK(sc_f[1][3] == 7753);

    t = m.face_tuple_from_vids(792, 838, 1076);
    REQUIRE(m.is_valid_slow(t));    sc_f = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PF, t)).get_simplex_vector());
    REQUIRE(sc_f.size() == 1);
    CHECK(sc_f[0][0] == 792);
    CHECK(sc_f[0][1] == 838);
    CHECK(sc_f[0][2] == 955);
    CHECK(sc_f[0][3] == 1076);

    t = m.tet_tuple_from_vids(1839, 1950, 1983, 7956);
    REQUIRE(m.is_valid_slow(t));    sc_t = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PT, t)).get_simplex_vector());
    REQUIRE(sc_t.size() == 1);
    CHECK(sc_t[0][0] == 1839);
    CHECK(sc_t[0][1] == 1950);
    CHECK(sc_t[0][2] == 1983);
    CHECK(sc_t[0][3] == 7956);

    t = m.tet_tuple_from_vids(5886, 5967, 6096, 7796);
    REQUIRE(m.is_valid_slow(t));    sc_t = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PT, t)).get_simplex_vector());
    REQUIRE(sc_t.size() == 1);
    CHECK(sc_t[0][0] == 5886);
    CHECK(sc_t[0][1] == 5967);
    CHECK(sc_t[0][2] == 6096);
    CHECK(sc_t[0][3] == 7796);

    t = m.tet_tuple_from_vids(4458, 4487, 4527, 7811);
    REQUIRE(m.is_valid_slow(t));    sc_t = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PT, t)).get_simplex_vector());
    REQUIRE(sc_t.size() == 1);
    CHECK(sc_t[0][0] == 4458);
    CHECK(sc_t[0][1] == 4487);
    CHECK(sc_t[0][2] == 4527);
    CHECK(sc_t[0][3] == 7811);

    t = m.tet_tuple_from_vids(4645, 4704, 4753, 7385);
    REQUIRE(m.is_valid_slow(t));    sc_t = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PT, t)).get_simplex_vector());
    REQUIRE(sc_t.size() == 1);
    CHECK(sc_t[0][0] == 4645);
    CHECK(sc_t[0][1] == 4704);
    CHECK(sc_t[0][2] == 4753);
    CHECK(sc_t[0][3] == 7385);

    t = m.tet_tuple_from_vids(4186, 4260, 4264, 7872);
    REQUIRE(m.is_valid_slow(t));    sc_t = get_sorted_sc(m, SimplicialComplex::top_coface_simplex(m, Simplex(PT, t)).get_simplex_vector());
    REQUIRE(sc_t.size() == 1);
    CHECK(sc_t[0][0] == 4186);
    CHECK(sc_t[0][1] == 4260);
    CHECK(sc_t[0][2] == 4264);
    CHECK(sc_t[0][3] == 7872);

}
